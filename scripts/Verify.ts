import hre from "hardhat";
import axios from "axios";
import {Logger} from "tslog";
import logSettings from "../log_settings";
import {Misc} from "./Misc";
import {config as dotEnvConfig} from "dotenv";

const log: Logger = new Logger(logSettings);

dotEnvConfig();
// tslint:disable-next-line:no-var-requires
const argv = require('yargs/yargs')()
    .env('')
    .options({
        networkScanKey: {
            type: "string",
        },
    }).argv;

export class Verify {

    public static async verify(address: string) {
        await Misc.wait(5);
        try {
            await hre.run("verify:verify", {
                address
            })
        } catch (e) {
            log.info('error verify ' + e);
        }
    }

    // tslint:disable-next-line:no-any
    public static async verifyWithArgs(address: string, args: any[]) {
        try {
            await hre.run("verify:verify", {
                address, constructorArguments: args
            })
        } catch (e) {
            log.info('error verify ' + e);
        }
    }

    // tslint:disable-next-line:no-any
    public static async verifyWithContractName(address: string, contractPath: string, args?: any[]) {
        try {
            await hre.run("verify:verify", {
                address, contract: contractPath, constructorArguments: args
            })
        } catch (e) {
            log.info('error verify ' + e);
        }
    }

    // tslint:disable-next-line:no-any
    public static async verifyWithArgsAndContractName(address: string, args: any[], contractPath: string) {
        try {
            await hre.run("verify:verify", {
                address, constructorArguments: args, contract: contractPath
            })
        } catch (e) {
            log.info('error verify ' + e);
        }
    }


    public static async verifyProxy(adr: string) {
        try {

            const resp =
                await axios.post(
                    (await Misc.getNetworkScanUrl()) +
                    `?module=contract&action=verifyproxycontract&apikey=${argv.networkScanKey}`,
                    `address=${adr}`);
            // log.info("proxy verify resp", resp.data);
        } catch (e) {
            log.info('error proxy verify ' + adr + e);
        }
    }

}